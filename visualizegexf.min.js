var AppState={EdgeShowing:false,MapShowing:false,FixScale:false,UseMapCoordinate:false};var AppObj={map:-1,mapbnd:0,mapSuggestZoom:16,nodeTravelDelta:0.04,mapLightUpDelta:-0.03,sigmaLayerAlpha:0.4,showNodeInfo:null,hideNodeInfo:null};$(document).ready(function(){$("#clear-graph").click(function(){if(!(typeof(sigInst)==="undefined")){console.log("clearing house");sigInst._core.graph.nodes=[];sigInst._core.graph.edges=[];sigInst.draw()}});$("#data-file-select").change(function(){if(!(typeof(sigInst)==="undefined")){console.log("clearing house");sigInst._core.graph.nodes=[];sigInst._core.graph.edges=[];sigInst.draw()}init($(this).attr("value"))});$(".navbar.navbar-fixed-top").hide();$.ajax({url:"listgexf.php",dataType:"text",success:function(d){window.gexflist=d;files=gexflist.split("</br>");files.forEach(function(e){if(e.length>4){$("#data-file-select").append('<option value="'+e+'">'+e+"</option>")}})}});$("#show-edges").click(function(){if(!AppState.EdgeShowing){if(typeof(sigInst)!="undefined"){sigInst.dispatch("downgraph");sigInst._core.graph.edges.forEach(function(d){d.color=d.source.color;d.hidden=false});sigInst.draw(2,2,2)}AppState.EdgeShowing=true;this.innerHTML="Hide Edges"}else{if(typeof(sigInst)!="undefined"){sigInst.dispatch("downgraph");sigInst._core.graph.edges.forEach(function(d){d.hidden=true});sigInst.draw(2,2,2)}AppState.EdgeShowing=false;this.innerHTML="Show Edges"}});$("#show-map").click(function(){if(!AppState.MapShowing){$("#sigma-example").css({background:"rgba(0,0,0,1.0)"});if(typeof(sigInst)!="undefined"){centerMap();AppObj.map.setZoom(AppObj.mapSuggestZoom);$("#map_canvas").show();sigInst.iterNodes(function(e){e.attr.orgX=e.displayX;e.attr.orgY=e.displayY});drawOnMap(AppObj.nodeTravelDelta)}var d="rgba(0,0,0,"+AppObj.sigmaLayerAlpha+")";$("#sigma-example").animate({backgroundColor:d},2000);AppState.MapShowing=true;this.innerHTML="Hide Map"}else{if(typeof(sigInst)!="undefined"){drawNormal(AppObj.nodeTravelDelta)}var d="rgba(0,0,0,1.0)";$("#sigma-example").animate({backgroundColor:d},2000);AppState.MapShowing=false;this.innerHTML="Show Map"}});var a=navigator.userAgent.match(/iPad/i)!=null;if(a){$("#stop-layout").hide();$("#clear-graph").hide();$("#group_separation").hide();$("#group_separation_label").hide();$("#data-file-select").hide();$("body").css({"padding-top":"0px"});$(".sigma-parent").css({top:"25px"});$("#info-panel").css({top:"25px"});init("graph_swipe.gexf");$("#Platform").bind("touchmove",function(f){var d=$("#Platform");console.log(d);if((d.scrollTop()+d.innerHeight())>d[0].scrollHeight){f.preventDefault()}});document.addEventListener("touchstart",function(f){var g=f.touches[0];sigInst._core.graph.checkHover(g.pageX,g.pageY-25);var d=sigInst._core.graph.nodes.filter(function(e){return !!e.hover}).map(function(e){return e.id});if(!!d){sigInst.dispatch("downnodes",d);f.preventDefault()}})}$("#sigma-example").click(function(d){window.e=d});$("#map-zoom-in").click(function(){if(AppState.MapShowing){var d=AppObj.map.getZoom();AppObj.map.setZoom(d+1);drawOnMap(0.1)}});$("#map-zoom-out").click(function(){if(AppState.MapShowing){var d=AppObj.map.getZoom();AppObj.map.setZoom(d-1);drawOnMap(0.1)}});$("#map-move-left").click(function(){c(0,-0.1)});$("#map-move-right").click(function(){c(0,0.1)});$("#map-move-up").click(function(){c(0.1,0)});$("#map-move-down").click(function(){c(-0.1,0)});function c(e,d){if(AppState.MapShowing){mc=AppObj.map.getCenter();AppObj.mapbnd=AppObj.map.getBounds();NE=AppObj.mapbnd.getNorthEast();SW=AppObj.mapbnd.getSouthWest();rangeLat=NE.lat()-SW.lat();rangeLng=NE.lng()-SW.lng();lat=mc.lat()+rangeLat*e;lng=mc.lng()+rangeLng*d;mc=new google.maps.LatLng(lat,lng);AppObj.map.setCenter(mc);drawOnMap(0.1)}}$("#map-brighter").click(function(){console.log("clicked");b(-0.05)});$("#map-darker").click(function(){b(0.05)});var b=function(d){console.log("inside");backgroundCSS=$("#sigma-example").css("background");idx=backgroundCSS.indexOf(")");alpha=parseFloat(backgroundCSS.slice(13,idx));console.log("alpha is"+alpha);alpha+=d;if(alpha>0.99){alpha=0.99}if(alpha<0.01){alpha=0.01}AppObj.sigmaLayerAlpha=alpha;background="rgba(0,0,0,"+alpha+")";console.log(background);$("#sigma-example").css({background:background})};initializeMap();$("#sigma-example").css({background:"rgba(0,0,0,1.0)"})});function centerMap(){var b=sigInst._core.graph.nodes.map(function(c){return parseFloat(c.attr.attributes[latIdx].val)});var a=sigInst._core.graph.nodes.map(function(c){return parseFloat(c.attr.attributes[lngIdx].val)});window.lats=b;window.lngs=a;latc=b.reduce(function(d,c){return d+c},0)/b.length;lngc=a.reduce(function(d,c){return d+c},0)/a.length;latmax=Math.max.apply(null,b);latmin=Math.min.apply(null,b);lngmax=Math.max.apply(null,a);lngmin=Math.min.apply(null,a);rangelat=latmax-latmin;factorlat=rangelat/0.0004;raiselat=Math.ceil(Math.log(factorlat)/Math.log(2));rangelng=lngmax-lngmin;factorlng=rangelng/0.0004;raiselng=Math.ceil(Math.log(factorlng)/Math.log(2));AppObj.mapSuggestZoom=22-Math.max(raiselat,raiselng);mapc=new google.maps.LatLng(latc,lngc);AppObj.map.setCenter(mapc)}var mapRanges={};var mapRange=function(){AppObj.mapbnd=AppObj.map.getBounds();NE=AppObj.mapbnd.getNorthEast();SW=AppObj.mapbnd.getSouthWest();rangeLat=NE.lat()-SW.lat();rangeLng=NE.lng()-SW.lng();zoom=AppObj.map.getZoom();mapRanges[zoom]=[rangeLat,rangeLng];console.log("zoom:"+zoom+" rangeLat:"+rangeLat+" rangeLng"+rangeLng)};function initializeMap(){var a={zoom:8,center:new google.maps.LatLng(-34.397,150.644),mapTypeId:google.maps.MapTypeId.ROADMAP};AppObj.map=new google.maps.Map(document.getElementById("map_canvas"),a)}function drawOnMap(d){console.log(d);d=parseFloat(d);if(d<0.01){d=0.01}if(d>1){d=1}AppObj.mapbnd=AppObj.map.getBounds();var b=$("#sigma-example").height();var f=$("#sigma-example").width();function a(j,g,k,h,i){NE=AppObj.mapbnd.getNorthEast();SW=AppObj.mapbnd.getSouthWest();dispx=i*(g-SW.lng())/(NE.lng()-SW.lng());dispy=h-h*(j-SW.lat())/(NE.lat()-SW.lat());return[dispx,dispy]}function c(g){n1=sigInst._core.graph.nodes[1];n2=sigInst._core.graph.nodes[10];dispx=g[0];dispy=g[1];x=n1.x+(n2.x-n1.x)*(dispx-n1.displayX)/(n2.displayX-n1.displayX);y=n1.y+(n2.y-n1.y)*(dispy-n1.displayY)/(n2.displayY-n1.displayY);return[x,y]}AppState.FixScale=true;AppState.UseMapCoordinate=true;sigInst.iterNodes(function(g){lat=parseFloat(g.attr.attributes[latIdx].val);lng=parseFloat(g.attr.attributes[lngIdx].val);disp=a(lat,lng,AppObj.mapbnd,b,f);loc=disp;g.attr.targetX=loc[0];g.attr.sourceX=g.displayX;g.attr.targetY=loc[1];g.attr.sourceY=g.displayY});var e=function(){var h=0;var g=function(){sigInst.iterNodes(function(i){i.attr.mapx=i.attr.sourceX*(1-h)+i.attr.targetX*h;i.attr.mapy=i.attr.sourceY*(1-h)+i.attr.targetY*h}).draw(2,2,2);if(h<1){h+=d;setTimeout(g,100)}};setTimeout(g,100)};e()}function drawNormal(a){sigInst.iterNodes(function(c){c.attr.targetX=c.attr.orgX;c.attr.sourceX=c.displayX;c.attr.targetY=c.attr.orgY;c.attr.sourceY=c.displayY});var b=function(){var d=0;var c=function(){sigInst.iterNodes(function(e){e.attr.mapx=e.attr.sourceX*(1-d)+e.attr.targetX*d;e.attr.mapy=e.attr.sourceY*(1-d)+e.attr.targetY*d}).draw(2,2,2);if(d<1){d+=a;setTimeout(c,100)}};setTimeout(c,100)};b();setTimeout(function(){AppState.FixScale=false;AppState.UseMapCoordinate=false},3000)}function shiftLocLatLng(a){deltaLat=a[0];deltaLng=a[1];sigInst.iterNodes(function(b){lat=parseFloat(b.attr.attributes[latIdx].val)+deltaLat;lng=parseFloat(b.attr.attributes[lngIdx].val)+deltaLng;b.attr.attributes[latIdx].val=""+lat;b.attr.attributes[lngIdx].val=""+lng});drawOnMap(0.1)}function shiftMapLatLng(a){mc=AppObj.map.getCenter();lat=mc.lat()+a[0];lng=mc.lng()+a[1];mc=new google.maps.LatLng(lat,lng);AppObj.map.setCenter(mc)}function adjustMap(a,c,b){shiftMapLatLng([a,c]);AppObj.map.setZoom(b);drawOnMap(0.1)};